### 快速幂

要求$a^k \ mod \ p$，先预处理出来这些值：
$$
a^{2^0} \ mod \ p \\
a^{2^1} \ mod \ p \\
a^{2^2} \ mod \ p \\
... \\
a^{2^{logk}} \ mod \ p
$$
 其实就是将$a^k$拆成若干个$a^{2^i}$的乘积的形式，因为一个正数$k$可以用二进制来表示，所以相应的$i$位置就拿$a^{2^i}$出来，乘在一起就把所求的$a^k$求出来了：
$$
\begin{aligned}
a^k & = a^{2^{x_1}} + a^{2^{x_2}} + a^{2^{x_3}} + ... \\
& = a^{2^{x_1} + 2^{x_2} + 2^{x_3} + ...}
\end{aligned}
$$

所以只要将$k$化成二进制表示就可以了，比如$(k)_{10} = (110110)_2$，那么：
$$
k = 2^1 + 2^2 + 2^4 + 2^5
$$
预处理的时间复杂度是$O(logk)$，因为只有$logk$个数，在计算的时候，最多是拆成$logk$个数相加，总共的时间复杂度就是$O(logk)$。

#### 算法流程

只要考虑预处理的思路：
$$
\begin{align}
a^{2^0} &= a^1 = a \\
a^{2^1} &= a^{2^0 \cdot 2} = (a^{2^0})^2 \\
a^{2^2} &= a^{2^1 \cdot 2} = (a^{2^1})^2 \\
...
\end{align}
$$
每一个数都是上一个数的平方模p，最多平方k次就能都预处理出来了。在预处理的过程中可以顺便把结果算出来，不用真的打表。

### 习题：快速幂求乘法逆元

以下“$\equiv$”是同余符号，$a \equiv b \ (mod \ c)$表示$a$和$b$在模$c$的时候同余。

如果$\frac{a}{b} \equiv a \cdot x \ (mod \ m)$，即所有的能整除的$\frac{a}{b}$和$a \cdot x$对$m$取模的结果是相等的，则称$x$是$b$在模$m$条件下的乘法逆元，可以将$b$的逆元记作$b^{-1}$。

#### 乘法逆元的性质

因为
$$
\frac{a}{b} \equiv a \cdot b^{-1} \ (mod \ m)
$$
所以
$$
b \cdot \frac{a}{b} \equiv b \cdot a \cdot b^{-1} \ (mod \ m)
$$
所以
$$
a \equiv a \cdot b \cdot b^{-1} \ (mod \ m)
$$

所以
$$
b \cdot b^{-1} \equiv 1 \ (mod \ m)
$$
也就是说$b$和$b$的乘法逆元$b^{-1}$的乘积在模$m$的条件下为$1$，这也是复合逆元的语义的。所以目的也就是给定一个$b$，希望找到它的乘法逆元$x$，使得$b \cdot x$在模$m$的条件下同余$1$，即$b \cdot x \equiv 1 \ (mod \ m)$。

#### 求解

题目里给出的$m$是质数，根据**费马小定理**知，如果$m$是质数，$b$是一个和$m$互质的整数，则有：
$$
b^{m-1} \equiv 1 \ (mod \ m)
$$
将左边提出一个$b$，则有：
$$
b \cdot b^{m-2} \equiv 1 \ (mod \ m)
$$
所以在$b$和$m$互质的情况下，要求$b$在模$m$下的乘法逆元，只要求$b^{m-2}$就可以了，所以这题就是直接用快速幂取模求$b^{m-2} \ mod \ m$就完事了（$b$在模$m$下的乘法逆元，模$m$之后，仍然是它在模$m$下的乘法逆元）。

#### 无解的情况

因为题目里给出的$m$是质数，如果$b$是$m$的倍数，$b \cdot x$也一定是$m$的倍数，模$m$一定等于$0$，而不会等于$1$，这种时候就无解了。反之如果$b$不是$m$的倍数，由费马定理可以构造出上面的解，这时一定有解。

当无解时，快速幂取模$b^{m-1} \ mod \ m = 0$，但是不能直接判断这个qmi的结果来检查有没有解，因为当$b=m=2$时，$2^{2-2} \ mod \ 2 = 1$，但是实际上这应该是无解的。